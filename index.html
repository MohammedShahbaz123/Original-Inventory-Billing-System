<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventory & Invoices</title>
  <link rel="stylesheet" href="./Style.css">
</head>
<body>
  <header class="sidebar">
    <h2>Inventory & Billing</h2>
    <nav class="sidebar-menu">
      <a href="#" onclick="Navigation.goToDashboard(); return false;" class="sidebar-item active" id="dashboard-nav">
        <span class="sidebar-icon">üè†</span>Dashboard
      </a>
      <a href="#" onclick="showPartyManagement(); return false;" class="sidebar-item">
        <span class="sidebar-icon" id="parties-nav">üë•</span>Parties
      </a>
      <a href="#" onclick="loadInventory(); return false;" class="sidebar-item">
        <span class="sidebar-icon" id="inventory-nav">üì¶</span>Inventory
      </a>
      <a href="#" onclick="loadSales(); return false;" class="sidebar-item">
        <span class="sidebar-icon" id="sales-nav">üí∞</span>Sales
      </a>
      <a href="#" onclick="loadPurchases(); return false;" class="sidebar-item">
        <span class="sidebar-icon" id="purchase-nav">üõí</span>Purchases
      </a>
    </nav>
  </header>

  <main class="content">
    <!-- Dashboard Page -->
    <div id="dashboard" class="page">
      <!-- Content will be populated by dashboard.js -->
      <footer class="footer">
        <div class="footer-content">
          <p>&copy; 2024 Business Management System. All rights reserved.</p>
          <div class="footer-links">
            <span>üìä Version 1.0</span>
            <span>üïí Last updated: Today</span>
          </div>
        </div>
      </footer> 
    </div>

    <!-- Party Management Page -->
    <div id="party-management" class="page hidden">
      <div class="header">
        <div class="header-left">
          <button onclick="Navigation.goBackToPreviousPage()" class="back-arrow-btn">‚Üê</button>
          <h1>Party Management</h1>
        </div>
        <div class="header-right">
          <button onclick="loadParties()" class="refresh-btn">üîÑ Refresh</button>
        </div>
      </div>
      
      <div class="controls">
        <div class="controls-left">
          <input type="text" id="partiesSearch" placeholder="Search parties..." 
                 class="search-input" onkeyup="filterParties()">
        </div>
        <div class="controls-right">
          <button onclick="showAddPartyForm(); return false;" class="create-btn">+ Add Party</button>
        </div>
      </div>
      
      <div class="page-content">
        <div class="parties-grid" id="parties-list">
          <div class="parties-empty-state">
            <div class="parties-empty-icon">üë•</div>
            <h3>Loading Parties...</h3>
            <p>Please wait while we load your parties</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Create Item Page -->
    <div id="createItem" class="page hidden">
      <div class="header">
        <div class="header-left">
          <button onclick="Navigation.goBackToPreviousPage()" class="back-arrow-btn">‚Üê</button>
          <h1>Add New Item</h1>
        </div>
        <div class="header-right">
          <button onclick="resetItemForm()" class="secondary-btn">üîÑ Reset</button>
        </div>
      </div>
      
      <div class="form-container">
        <form id="itemForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="itemName">Item Name *</label>
              <input type="text" id="itemName" required 
                     placeholder="Enter item name (e.g., Samsung TV, iPhone 15)"
                     maxlength="100">
              <div class="form-hint">Enter a descriptive name for the item</div>
            </div>
            
            <div class="form-group">
              <label for="itemPrice">Price (‚Çπ) *</label>
              <div class="input-with-icon">
                <span class="input-icon">‚Çπ</span>
                <input type="number" id="itemPrice" required min="0" step="0.01"
                       placeholder="0.00" oninput="formatPrice(this)">
              </div>
              <div class="form-hint">Enter the selling price per unit</div>
            </div>
            
            <div class="form-group">
              <label for="itemStock">Initial Stock *</label>
              <input type="number" id="itemStock" required min="0" step="1"
                     placeholder="0" oninput="validateStock(this)">
              <div class="form-hint">Enter the initial quantity in stock</div>
            </div>
            
            <div class="form-group">
              <label for="itemCategory">Category (Optional)</label>
              <select id="itemCategory">
                <option value="">Select Category</option>
                <option value="electronics">Electronics</option>
                <option value="clothing">Clothing</option>
                <option value="furniture">Furniture</option>
                <option value="groceries">Groceries</option>
                <option value="books">Books</option>
                <option value="other">Other</option>
              </select>
              <div class="form-hint">Categorize for better organization</div>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" onclick="Navigation.goBackToPreviousPage()" class="cancel-btn">Cancel</button>
            <button type="submit" class="submit-btn">
              <span id="itemSubmitText">‚ûï Add Item</span>
              <div id="itemLoading" class="loading-spinner" style="display: none;"></div>
            </button>
          </div>
        </form>
      </div>
      
      <div class="quick-templates">
        <h3>üí° Quick Add Common Items</h3>
        <div class="template-buttons">
          <button onclick="fillItemTemplate('Smartphone', 29999, 10)" class="template-btn">üì± Smartphone ‚Çπ29,999</button>
          <button onclick="fillItemTemplate('Laptop', 59999, 5)" class="template-btn">üíª Laptop ‚Çπ59,999</button>
          <button onclick="fillItemTemplate('Headphones', 2999, 20)" class="template-btn">üéß Headphones ‚Çπ2,999</button>
          <button onclick="fillItemTemplate('T-Shirt', 899, 50)" class="template-btn">üëï T-Shirt ‚Çπ899</button>
        </div>
      </div>
    </div>

    <!-- Create Party Page -->
    <div id="createParty" class="page hidden">
      <div class="header">
        <div class="header-left">
          <button onclick="Navigation.goBackToPreviousPage()" class="back-arrow-btn">‚Üê</button>
          <h1>Add New Party</h1>
        </div>
        <div class="header-right">
          <button onclick="resetPartyForm()" class="secondary-btn">üîÑ Reset</button>
        </div>
      </div>
      
      <div class="form-container">
        <form id="partyForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="partyName">Party Name *</label>
              <input type="text" id="partyName" required 
                     placeholder="Enter party name (e.g., John Doe, ABC Corporation)"
                     maxlength="100" oninput="checkPartyExists(this.value)">
              <div id="partyExists" class="error-message" style="display: none;">‚ö†Ô∏è This party already exists</div>
              <div class="form-hint">Enter customer or supplier name</div>
            </div>
            
            <div class="form-group">
              <label for="partyType">Party Type *</label>
              <select id="partyType" required onchange="togglePartyFields()">
                <option value="">Select Type</option>
                <option value="customer">Customer</option>
                <option value="supplier">Supplier</option>
                <option value="both">Both (Customer & Supplier)</option>
              </select>
              <div class="form-hint">Select the type of party</div>
            </div>
            
            <!-- In createParty page - update the phone input section -->
<div class="form-group">
    <label for="partyPhone">Phone Number</label>
    <input type="tel" id="partyPhone" 
           placeholder="98765 43210"
           oninput="formatPhone(this)"
           onblur="validatePhoneInput(this)">
    <div class="phone-error error-message" style="display: none;">
        ‚ö†Ô∏è Please enter a valid 10-digit Indian mobile number starting with 6,7,8,9
    </div>
    <div class="form-hint">Optional 10-digit Indian mobile number</div>
</div>
            
            <div class="form-group">
              <label for="partyEmail">Email Address</label>
              <input type="email" id="partyEmail" 
                     placeholder="party@example.com">
              <div class="form-hint">Optional email address</div>
            </div>
            
            <div class="form-group full-width">
              <label for="partyAddress">Address</label>
              <textarea id="partyAddress" rows="3" 
                        placeholder="Enter complete address..."
                        maxlength="200"></textarea>
              <div class="form-hint">Optional address details</div>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" onclick="Navigation.goBackToPreviousPage()" class="cancel-btn">Cancel</button>
            <button type="submit" class="submit-btn">
              <span id="partySubmitText">üë• Add Party</span>
              <div id="partyLoading" class="loading-spinner" style="display: none;"></div>
            </button>
          </div>
        </form>
      </div>
      
      <div class="existing-parties">
        <h3>üìã Existing Parties</h3>
        <div id="existingPartiesList" class="parties-list">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- Sales Invoice Page -->
    <div id="salesInvoice" class="page hidden">
      <div class="header">
        <div class="header-left">
          <button onclick="Navigation.goBackToPreviousPage()" class="back-arrow-btn">‚Üê</button>
          <h1>Create Sale Invoice</h1>
        </div>
        <div class="header-right">
          <button onclick="clearSaleInvoice()" class="secondary-btn">üóëÔ∏è Clear All</button>
          <button onclick="saveSaleInvoice()" class="primary-btn" id="saveSaleBtn">üíæ Save Invoice</button>
        </div>
      </div>
      
      <div class="invoice-container">
        <div class="invoice-header">
          <div class="invoice-meta">
            <div class="meta-group">
              <label for="saleDate">Invoice Date *</label>
              <input type="date" id="saleDate" required>
            </div>
            <div class="meta-group">
              <label for="saleParty">Customer *</label>
              <select id="saleParty" required>
                <option value="">Select Customer</option>
              </select>
              <button type="button" onclick="showPage('createParty')" class="quick-add-btn">+ Add New</button>
            </div>
          </div>
        </div>
        
        <div class="add-items-section">
          <h3>‚ûï Add Items</h3>
          <div class="item-form-grid">
            <div class="form-group">
              <label for="saleItem">Item *</label>
              <input type="text" id="saleItem" list="saleItemsList" 
                     placeholder="Search or select item"
                     oninput="updateItemPrice()">
              <datalist id="saleItemsList"></datalist>
              <div id="itemStockInfo" class="stock-info" style="display: none;"></div>
            </div>
            
            <div class="form-group">
              <label for="saleQty">Quantity *</label>
              <input type="number" id="saleQty" min="1" step="1" 
                     placeholder="0" oninput="calculateSaleSubtotal()">
            </div>
            
            <div class="form-group">
              <label for="salePrice">Price (‚Çπ) *</label>
              <input type="number" id="salePrice" min="0.01" step="0.01" 
                     placeholder="0.00" oninput="calculateSaleSubtotal()">
            </div>
            
            <div class="form-group">
              <label for="saleSubtotal">Subtotal</label>
              <input type="text" id="saleSubtotal" readonly 
                     placeholder="0.00" class="readonly-input">
            </div>
            
            <div class="form-group">
              <label>&nbsp;</label>
              <button type="button" onclick="addSaleItemToInvoice()" class="add-item-btn">‚ûï Add to Invoice</button>
            </div>
          </div>
        </div>
        
        <div class="items-table-section">
          <h3>üìã Invoice Items</h3>
          <div id="saleInvoiceTableContainer">
            <table id="saleInvoiceTable" class="data-table">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Qty</th>
                  <th>Price</th>
                  <th>Subtotal</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="saleInvoiceItems">
                <!-- Items will be added here -->
              </tbody>
              <tfoot>
                <tr class="grand-total">
                  <td colspan="3">Grand Total</td>
                  <td id="saleGrandTotal">‚Çπ0.00</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
        
        <div class="notes-section">
          <label for="saleNotes">Additional Notes (Optional)</label>
          <textarea id="saleNotes" rows="2" placeholder="Any additional notes for this invoice..."></textarea>
        </div>
      </div>
    </div>

    <!-- Purchase Invoice Page -->
    <div id="purchaseInvoice" class="page hidden">
      <div class="header">
        <div class="header-left">
          <button onclick="Navigation.goBackToPreviousPage()" class="back-arrow-btn">‚Üê</button>
          <h1>Create Purchase Invoice</h1>
        </div>
        <div class="header-right">
          <button onclick="clearPurchaseInvoice()" class="secondary-btn">üóëÔ∏è Clear All</button>
          <button onclick="savePurchaseInvoice()" class="primary-btn" id="savePurchaseBtn">üíæ Save Invoice</button>
        </div>
      </div>
      
      <div class="invoice-container">
        <div class="invoice-header">
          <div class="invoice-meta">
            <div class="meta-group">
              <label for="purchaseDate">Invoice Date *</label>
              <input type="date" id="purchaseDate" required>
            </div>
            <div class="meta-group">
              <label for="purchaseParty">Supplier *</label>
              <select id="purchaseParty" required>
                <option value="">Select Supplier</option>
              </select>
              <button type="button" onclick="showPage('createParty')" class="quick-add-btn">+ Add New</button>
            </div>
          </div>
        </div>
        
        <div class="add-items-section">
          <h3>‚ûï Add Items</h3>
          <div class="item-form-grid">
            <div class="form-group">
              <label for="purchaseItem">Item *</label>
              <input type="text" id="purchaseItem" list="purchaseItemsList" 
                     placeholder="Search or select item"
                     oninput="updatePurchaseItemPrice()">
              <datalist id="purchaseItemsList"></datalist>
              <button type="button" onclick="showPage('createItem')" class="quick-add-btn">+ New Item</button>
            </div>
            
            <div class="form-group">
              <label for="purchaseQty">Quantity *</label>
              <input type="number" id="purchaseQty" min="1" step="1" 
                     placeholder="0" oninput="calculatePurchaseSubtotal()">
            </div>
            
            <div class="form-group">
              <label for="purchasePrice">Price (‚Çπ) *</label>
              <input type="number" id="purchasePrice" min="0.01" step="0.01" 
                     placeholder="0.00" oninput="calculatePurchaseSubtotal()">
            </div>
            
            <div class="form-group">
              <label for="purchaseSubtotal">Subtotal</label>
              <input type="text" id="purchaseSubtotal" readonly 
                     placeholder="0.00" class="readonly-input">
            </div>
            
            <div class="form-group">
              <label>&nbsp;</label>
              <button type="button" onclick="addPurchaseItemToInvoice()" class="add-item-btn">‚ûï Add to Invoice</button>
            </div>
          </div>
        </div>
        
        <div class="items-table-section">
          <h3>üìã Purchase Items</h3>
          <div id="purchaseInvoiceTableContainer">
            <table id="purchaseInvoiceTable" class="data-table">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Qty</th>
                  <th>Price</th>
                  <th>Subtotal</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="purchaseInvoiceItems">
                <!-- Items will be added here -->
              </tbody>
              <tfoot>
                <tr class="grand-total">
                  <td colspan="3">Grand Total</td>
                  <td id="purchaseGrandTotal">‚Çπ0.00</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Sales Page -->
    <div id="sales" class="page hidden">
      <div class="header">
        <div class="header-left">
          <h1>Sales Records</h1>
          <div id="salesGrandTotal" class="total-display">
            <!-- Total sales will be displayed here -->
          </div>
        </div>
        <div class="header-right">
          <button onclick="loadSales()" class="refresh-btn">üîÑ Refresh</button>
        </div>
      </div>
      
      <div class="controls">
        <div class="controls-left">
          <input type="text" id="salesSearch" placeholder="Search by party or invoice..." 
                 class="search-input" onkeyup="filterSales()">
          <select id="salesDateRangeFilter" onchange="filterSalesByDateRange()" class="date-filter">
            <option value="all">All Time</option>
            <option value="today">Today</option>
            <option value="yesterday">Yesterday</option>
            <option value="thisWeek">This Week</option>
            <option value="lastWeek">Last Week</option>
            <option value="thisMonth">This Month</option>
            <option value="lastMonth">Last Month</option>
            <option value="thisYear">This Year</option>
            <option value="lastYear">Last Year</option>
            <option value="custom">Custom Range</option>
          </select>
          
          <div id="salesCustomDateRange" class="custom-date-range">
            <input type="date" id="salesCustomDateFrom">
            <span>to</span>
            <input type="date" id="salesCustomDateTo">
            <button onclick="applySalesCustomDateRange()" class="apply-btn">Apply</button>
          </div>
        </div>
        
        <div class="controls-right">
          <button onclick="showPage('salesInvoice')" class="create-sale-btn">+ Create Sale</button>
        </div>
      </div>
      
      <div id="salesTableContainer">
        <table id="salesTable" class="data-table">
          <!-- Table will be populated by JavaScript -->
        </table>
      </div>
    </div>

    <!-- Purchases Page -->
    <div id="purchases" class="page hidden">
      <div class="header">
        <div class="header-left">
          <h1>Purchase Records</h1>
          <div id="purchasesGrandTotal" class="total-display">
            <!-- Total purchase will be displayed here -->
          </div>
        </div>
        <div class="header-right">
          <button onclick="loadPurchases()" class="refresh-btn">üîÑ Refresh</button>
        </div>
      </div>
      
      <div class="controls">
        <div class="controls-left">
          <input type="text" id="purchasesSearch" placeholder="Search by party or invoice..." 
                 class="search-input" onkeyup="filterPurchases()">
          <select id="dateRangeFilter" onchange="filterByDateRange()" class="date-filter">
            <option value="all">All Time</option>
            <option value="today">Today</option>
            <option value="yesterday">Yesterday</option>
            <option value="thisWeek">This Week</option>
            <option value="lastWeek">Last Week</option>
            <option value="thisMonth">This Month</option>
            <option value="lastMonth">Last Month</option>
            <option value="thisYear">This Year</option>
            <option value="lastYear">Last Year</option>
            <option value="custom">Custom Range</option>
          </select>
          
          <div id="customDateRange" class="custom-date-range">
            <input type="date" id="customDateFrom">
            <span>to</span>
            <input type="date" id="customDateTo">
            <button onclick="applyCustomDateRange()" class="apply-btn">Apply</button>
          </div>
        </div>
        
        <div class="controls-right">
          <button onclick="showPage('purchaseInvoice')" class="create-btn">+ Create Purchase</button>
        </div>
      </div>
      
      <div id="purchasesTableContainer">
        <table id="purchasesTable" class="data-table">
          <!-- Table will be populated by JavaScript -->
        </table>
      </div>
    </div>

    <!-- Inventory Page -->
    <div id="inventory" class="page hidden">
      <div class="header">
        <div class="header-left">
          <h1>Inventory</h1>
          <div id="inventorySummary" class="summary-display">
            <!-- Inventory summary will be displayed here -->
          </div>
        </div>
        <div class="header-right">
          <button onclick="loadInventory()" class="refresh-btn">üîÑ Refresh</button>
        </div>
      </div>
      
      <div class="controls">
        <div class="controls-left">
          <input type="text" id="inventorySearch" placeholder="Search by item name..." 
                 class="search-input" onkeyup="filterInventory()">
        </div>
        
        <div class="controls-right">
          <button onclick="showPage('createItem')" class="create-item-btn">+ Add Item</button>
        </div>
      </div>
      
      <div id="inventoryTableContainer">
        <table id="inventoryTable" class="data-table">
          <!-- Table will be populated by JavaScript -->
        </table>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/supabase-config.js"></script>
<script src="js/utils.js"></script>
<script src="js/supabase-service.js"></script>
<script src="js/parties.js"></script>
<script src="js/inventory.js"></script>
<script src="js/sales.js"></script>
<script src="js/purchases.js"></script>
<script src="js/invoices.js"></script>
<script src="js/dashboard.js"></script>
<script src="js/app.js"></script>
</body>
</html>